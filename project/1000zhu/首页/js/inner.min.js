$(function() {
    $("header").height($(window).height());
    $("header nav ul").append('<li class="bg"></li>');
    //if (!authentication()) return;
    dockEvent();
    $(window).bind("resize", function(e) {
        $("header").height($(window).height());
        var w = $(window).width() - 150;
        if (!$(".toolbar .switch").hasClass("glyphicon-th-list")) w = w - $("header").outerWidth();
        if (w < 1000) $("section.content .demo").width(w).find("img").addClass("img-responsive");
        else $("section.content .demo").width(1000).find("img").removeClass("img-responsive");
        setArtlist();
        setArtshow();
        setCaselist();
        setCaseshow()
    });
    $(".toolbar .switch").bind("touchstart click", function(e) {
        if ($(this).hasClass("glyphicon-th-list")) {
            $("header, .toolbar, section.content").addClass("active");
            $(this).removeClass("glyphicon-th-list");
            $(this).addClass("glyphicon-chevron-left")
        } else {
            $("header, .toolbar, section.content").removeClass("active");
            $(this).removeClass("glyphicon-chevron-left");
            $(this).addClass("glyphicon-th-list")
        }
        setArtlist();
        setArtshow();
        setCaselist();
        setCaseshow()
    });
    if ($(".caseshow").size() == 0) $(".toolbar .switch").trigger("click");
    $(".toolbar .switch").after("<div class='logo'><a href='http://www.1000zhu.com/'><img src='" + $("header .box>a img").attr("src") + "' class='img-responsive' /></a></div>");
    $(".toolbar .category").each(function(i, item) {
        if ($(item).find("a.btn-primary").length == 0) $(item).find("a:eq(0)").addClass("btn-primary")
    });
    if ($(".toolbar .category").size() > 0) {
        var strHtml = "<div class='btn-group mini'>";
        strHtml += "<button class='btn btn-default dropdown-toggle' data-toggle='dropdown'>" + $(".toolbar .category a.btn-primary").html() + " <span class='caret'></span></button>";
        strHtml += "<ul class='dropdown-menu dropdown-menu-right'>";
        $(".toolbar .category a").each(function(i, item) {
            strHtml += "<li><a href='" + $(this).attr("href") + "'>" + $(this).html() + "</a></li>"
        });
        strHtml += "</ul>";
        strHtml += "</div>";
        $(".toolbar").append(strHtml)
    }
    $(".toolbar .btnList .btn").each(function(i, item) {
        if ($(item).attr("href").indexOf("javascript:") == 0) $(item).addClass("disabled")
    });
    if ($(".toolbar .btnList").size() > 0) {
        var strHtml = "<div class='mini'>";
        strHtml += $(".toolbar .btnList").html();
        strHtml += "</div>";
        $(".toolbar").append(strHtml);
        $(".toolbar .mini a.btn").eq(0).html("<span class='glyphicon glyphicon-th-list'></span>");
        $(".toolbar .mini a.btn").eq(1).html("<span class='glyphicon glyphicon-arrow-left'></span>");
        $(".toolbar .mini a.btn").eq(2).html("<span class='glyphicon glyphicon-arrow-right'></span>")
    }
    var url = document.location.href.toLowerCase();
    $("header nav ul li a:gt(0)").each(function(i, item) {
        if (url.indexOf($(item).attr("href").toLowerCase()) > 0) $(item).parent().addClass("active")
    });
    if ($("header nav ul li.active").length == 0) $("header nav ul li:eq(0)").addClass("active");
    $("header nav ul li").not(".bg").bind("mouseenter", function(e) {
        $(this).parent().find("a").css("color", "#333");
        $(this).find("a").css("color", "White");
        $("header nav ul li.bg").css("top", $(this).position().top)
    });
    $("header nav ul").bind("mouseleave", function() {
        $("header nav ul li.active").trigger("mouseenter").find("a").css("color", "White")
    }).trigger("mouseleave");
    $("section.content .words p").each(function(i, item) {
        if ($(item).css("text-align") == "center") $(item).css("text-align", "").attr("align", "center")
    });
    $("section.content .words img").each(function(i, item) {
        if ($(item).attr("border") == "1") $(item).css("border", "1px solid #ccc")
    });
    $(".caselist .items li a").prepend('<div class="shade"><u></u></div>').append('<div class="bg"><u></u></div>');
    $(".caselist .items li img, .artshow .words img").addClass("img-responsive");
    if ($("header").outerWidth() == 0) {
        $(".paging").css("margin-left", parseInt(($(window).width() - $(".qzPagination").width()) / 2))
    }
    if ($("section.artshow").size() > 0) {
        $("section.content").append("<div class='footWechat'>" + $("header .wechat").html() + "</div>");
        $(".footWechat p").html("试试长按二维码加关注");
        if (window.location.hash.indexOf("weixin") > 0) $(document).attr("title", $(".artshow .box h1").html())
    }
});
var jsonp_server = "http://www.1000zhu.com/";

function authentication() {
    var suffix = "com",
        count = 1,
        dot = ".";
    var d = (count + 999).toString() + "zhu" + dot + suffix;
    if (window.location.host.indexOf(d) < 0 && window.location.host.indexOf("qianzhu.cn") < 0) {
        $("body").remove();
        return false
    }
    return true
}

function setArtlist() {
    if ($("section.artlist").size() == 0) return;
    var headerWidth = $("header").outerWidth();
    var switchBtn = $(".toolbar .switch");
    if (switchBtn.css("display") == "none" || switchBtn.hasClass("glyphicon-th-list")) headerWidth = 0;
    var leftWidth = $(".artlist ul.items li p.left").outerWidth();
    var ulMarginLeft = $(".artlist ul.items").css("margin-left").replace("px", "");
    var dockWidth = 100;
    if ($(".artlist ul.items li p.left").css("display") == "none") dockWidth = 0;
    else if ($(".dock").css("display") == "none") dockWidth = 30;
    $(".artlist ul.items li p.right").width($(window).width() - headerWidth - ulMarginLeft - leftWidth - dockWidth)
}

function setArtshow() {
    if ($("section.artshow").size() == 0) return;
    var headerWidth = $("header").outerWidth();
    var switchBtn = $(".toolbar .switch");
    if (switchBtn.css("display") == "none" || switchBtn.hasClass("glyphicon-th-list")) headerWidth = 0;
    var asideRight = 0;
    var boxMarginLeft = $(".artshow .box").css("margin-left").replace("px", "");
    if ($(".artshow aside").width() > 0) {
        asideRight = 75;
        boxMarginLeft = boxMarginLeft * 2
    }
    $(".artshow .box").width($(window).width() - headerWidth - boxMarginLeft - $(".artshow aside").outerWidth() - asideRight);
    var asideTop = parseInt(($(window).height() - $(".artshow aside").outerHeight()) / 2);
    $(".artshow aside").css("top", asideTop).addClass("active")
}

function setCaselist() {
    if ($("section.caselist").size() == 0) return;
    var headerWidth = $("header").outerWidth();
    var switchBtn = $(".toolbar .switch");
    if (switchBtn.css("display") == "none" || switchBtn.hasClass("glyphicon-th-list")) headerWidth = 0;
    var dockWidth = 70;
    if ($(".dock").css("display") == "none") dockWidth = 0;
    var contentWidth = $(window).width() - headerWidth - dockWidth;
    $("section.caselist").width(contentWidth);
    var liMarginLeft = parseInt($(".caselist ul.items li").css("margin-left").replace("px", ""));
    var liWidth = $(".caselist ul.items li").width() + liMarginLeft * 2;
    var col = parseInt(contentWidth / liWidth);
    var w = contentWidth - liWidth * col;
    $(".caselist ul.items").css("margin-left", parseInt(w / 2))
}

function setCaseshow() {
    if ($("section.caseshow").size() == 0) return;
    var headerWidth = $("header").outerWidth();
    var switchBtn = $(".toolbar .switch");
    if (switchBtn.css("display") == "none" || switchBtn.hasClass("glyphicon-th-list")) headerWidth = 0;
    var w = $(window).width() - headerWidth;
    var offset = 200;
    if ($(".dock").css("display") == "none") offset = 100;
    $(".caseshow").width(w);
    if (w - offset < 1000) $(".caseshow .demo").width(w - offset).find("img").addClass("img-responsive")
}

function dockEvent() {
    $(".dock").height($(".dock ul.icons li").length * 55 - 5);
    $(".dock ul.icons li i").bind("touchstart mouseenter click", function() {
        $(".dock ul.icons li").removeClass("active");
        $(this).parent().addClass("active")
    });
    $(".dock ul.icons li").bind("mouseleave", function() {
        $(".dock ul.icons li").removeClass("active")
    });
    $(".dock ul.icons li.up i").bind("touchstart click", function() {
        $("html,body").animate({
            scrollTop: 0
        }, 500)
    })
}
